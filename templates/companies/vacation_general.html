{% extends 'base/base_companies.html' %}
{% load crispy_forms_tags %}


{% block title %}
    Nomiweb.co - Portal Empresas - Vacaciones Resumen General 
{% endblock %}


{% block css %}

    .loan-status-checkbox {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
    }
{% endblock %}

{% block sub_titulo1 %} 
Novedades de Nomina
{% endblock %}


{% block sub_titulo2 %} 
Vacaciones
{% endblock %}

{% block actions %}

{% endblock %}

{% block titulo2 %} 
Listado de Personal 
{% endblock %}


{% block content %}
    
<div class="table-responsive">
    <table id='tabla-lista-vacation' class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Documento</th>
                <th>Nombre</th>
                <th>Contrato</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody>
            {% for item in contratos_empleados %}
                <tr>
                    <td>{{ item.idempleado__docidentidad }}</td>
                    <td>{{ item.idempleado__papellido }} {{ item.idempleado__sapellido }} {{ item.idempleado__pnombre }} {{ item.idempleado__snombre }}</td>
                    <td >{{ item.idcontrato }}</td>
                    <td>
                        <div class="d-flex justify-content-center">
                            <button type="button" class="btn btn-icon btn-sm btn-light-facebook me-2 btn-novedad" data-bs-toggle="modal" data-bs-target="#kt_modal_1" data-tipo="vacaciones">
                                <i class="fa-solid fa-plane-departure fs-3"></i>
                            </button>
                            
                            <button type="button" class="btn btn-icon btn-sm btn-light-instagram me-2 btn-novedad" data-bs-toggle="modal" data-bs-target="#kt_modal_1" data-tipo="ausencias">
                                <i class="fa-solid fa-calendar-xmark fs-3"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>



<div class="modal fade" tabindex="-1" id="kt_modal_1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable ">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Modal title</h3>

                <!--begin::Close-->
                <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close">
                    <i class="ki-duotone ki-cross fs-1"><span class="path1"></span><span class="path2"></span></i>
                </div>
                <!--end::Close-->
            </div>

            <div class="modal-body">
                <table id='tabla-lista-novedad' class="table table-striped table-bordered text-center">
                    <thead>
                        <tr>
                            <th>Novedad</th>
                            <th>Fecha Inicial</th>
                            <th>Ultimo Día</th>
                            <th>Días Cal</th>
                            <th>Días Vac</th>
                            <th>Pago</th>
                            <th>Periodo Ini</th>
                            <th>Periodo Fin</th>
                            <th>Id</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                    </tbody>
                </table>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}






{% block js %}


<script>
    function cargarContratos() {
        var empleadoSelect = document.getElementById('empleado');
        var empleadoId = empleadoSelect.value;
        window.location.href = `?empleado=${empleadoId}`;
    }
</script>


<script>
    $(document).ready(function() {
        $('#tabla-lista-vacation').DataTable({
            language: {
                "decimal":        "",
                "emptyTable":     "No se encontraron empleados para listar",
                "info":           "Mostrando _START_ a _END_ de _TOTAL_ entradas",
                "infoEmpty":      "Mostrando 0 a 0 de 0 entradas",
                "infoFiltered":   "(filtrado de _MAX_ entradas totales)",
                "infoPostFix":    "",
                "thousands":      ",",
                "lengthMenu":     "Mostrar _MENU_ entradas",
                "loadingRecords": "Cargando...",
                "processing":     "Procesando...",
                "search":         "Buscar:",
                "zeroRecords":    "No se encontraron registros coincidentes",
                "paginate": {
                    "first":      "Primero",
                    "last":       "Último",
                    "next":       "Siguiente",
                    "previous":   "Anterior"
                },
                "aria": {
                    "sortAscending":  ": activar para ordenar la columna ascendente",
                    "sortDescending": ": activar para ordenar la columna descendente"
                }
            },
            dom: 'frtip',
            order: [[1, 'asc']], 
            "pageLength": 10,                
        });
    });
</script>


    
    
<script>
    $(document).ready(function() {
        // Definir la variable global tipoNovedad
        let tipoNovedad = '';
    
        // Evento al hacer clic en el botón que abre el modal
        $('.btn-novedad').click(function() {
            // Obtener el tipo de novedad desde el botón presionado
            tipoNovedad = $(this).data('tipo');
        });
    
        // Evento al abrir el modal
        $('#kt_modal_1').on('show.bs.modal', function () {
            // Asegúrate de que tipoNovedad esté actualizado
            $.ajax({
                url: "{% url 'companies:get_novedades' %}",
                method: "GET",
                data: { tipo: tipoNovedad },
                success: function(data) {
                    // Limpiar el contenido actual de la tabla
                    $('#tabla-lista-novedad').DataTable().clear().destroy();
                    let tableBody = $('#tabla-lista-novedad tbody');
                    tableBody.empty(); // Limpiar la tabla antes de agregar los nuevos datos
    
                    // Agregar nuevos datos
                    data.forEach(function(item) {
                        let row = `<tr>
                            <td>${item.novedad}</td>
                            <td>${item.fecha_inicial}</td>
                            <td>${item.ultimo_dia}</td>
                            <td>${item.dias_cal}</td>
                            <td>${item.dias_vac}</td>
                            <td>${item.pago}</td>
                            <td>${item.periodo_ini}</td>
                            <td>${item.periodo_fin}</td>
                            <td>${item.id}</td>
                        </tr>`;
                        tableBody.append(row);
                    });
    
                    // Inicializar DataTable
                    $('#tabla-lista-novedad').DataTable({
                        language: {
                            "decimal":        "",
                            "emptyTable":     "No se encontraron empleados para listar",
                            "info":           "Mostrando _START_ a _END_ de _TOTAL_ entradas",
                            "infoEmpty":      "Mostrando 0 a 0 de 0 entradas",
                            "infoFiltered":   "(filtrado de _MAX_ entradas totales)",
                            "infoPostFix":    "",
                            "thousands":      ",",
                            "lengthMenu":     "Mostrar _MENU_ entradas",
                            "loadingRecords": "Cargando...",
                            "processing":     "Procesando...",
                            "search":         "Buscar:",
                            "zeroRecords":    "No se encontraron registros coincidentes",
                            "paginate": {
                                "first":      "Primero",
                                "last":       "Último",
                                "next":       "Siguiente",
                                "previous":   "Anterior"
                            },
                            "aria": {
                                "sortAscending":  ": activar para ordenar la columna ascendente",
                                "sortDescending": ": activar para ordenar la columna descendente"
                            }
                        },
                        dom: 'frtip',
                        order: [[1, 'asc']],
                        "pageLength": 10
                    });
                },
                error: function(xhr, status, error) {
                    console.error("Error loading data:", error);
                }
            });
        });
    });
</script>
    

{% endblock %}

